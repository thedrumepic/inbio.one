inbio.one {
    # 1. API
    reverse_proxy /api/* backend:8000 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }

    # 2. Uploads
    reverse_proxy /uploads/* backend:8000

    # 3. Принудительный роутинг HTML на бэкенд (для SEO инъекции)
    # Все, что не является статическим файлом, отправляем на бэкенд
    @html_pages {
        not path /api/*
        not path /uploads/*
        not path *.js
        not path *.css
        not path *.png
        not path *.jpg
        not path *.jpeg
        not path *.ico
        not path *.svg
        not path *.json
        not path *.map
    }
    reverse_proxy @html_pages backend:8000 {
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }

    # 4. Остальное (статика) - на фронтенд
    reverse_proxy * frontend:3000
}